(function(e){function t(t){for(var r,s,o=t[0],c=t[1],f=t[2],h=0,u=[];h<o.length;h++)s=o[h],Object.prototype.hasOwnProperty.call(a,s)&&a[s]&&u.push(a[s][0]),a[s]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);d&&d(t);while(u.length)u.shift()();return n.push.apply(n,f||[]),i()}function i(){for(var e,t=0;t<n.length;t++){for(var i=n[t],r=!0,o=1;o<i.length;o++){var c=i[o];0!==a[c]&&(r=!1)}r&&(n.splice(t--,1),e=s(s.s=i[0]))}return e}var r={},a={app:0},n=[];function s(t){if(r[t])return r[t].exports;var i=r[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=r,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(i,r,function(t){return e[t]}.bind(null,r));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var f=0;f<o.length;f++)t(o[f]);var d=c;n.push([0,"chunk-vendors"]),i()})({0:function(e,t,i){e.exports=i("56d7")},1:function(e,t){},2:function(e,t){},3:function(e,t){},3803:function(e,t,i){},4:function(e,t){},5:function(e,t){},"56d7":function(e,t,i){"use strict";i.r(t);i("e260"),i("e6cf"),i("cca6"),i("a79d");var r=i("2b0e"),a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[e.isFileLoad?e._e():r("div",{attrs:{id:"drop_zone"},on:{drop:function(t){return t.preventDefault(),e.addFile(t)},dragover:function(e){e.preventDefault()}}},[r("img",{attrs:{src:i("c93a"),alt:"UPLOAD"}}),r("span",[e._v("Put image here")]),r("p",[e._v("or")]),r("input",{attrs:{id:"img_input",type:"file",name:"file"},on:{change:e.addFileFromButton}}),r("label",{attrs:{for:"img_input"}},[e._v("Choose a file")])]),e.isFileLoad?r("ImProcessing",{attrs:{image:e.image}}):e._e()],1)},n=[],s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"app_main"}},[e._m(0),i("div",{attrs:{id:"infoSetup"}},[i("div",{attrs:{id:"info"}},[i("span",[e._v("Image size "+e._s(e.im_width)+"x"+e._s(e.im_height))]),i("span",[e._v("Channels 3")])]),i("div",{attrs:{id:"setup"}},[e._m(1),i("p",[e._v(" Set variance value: "),i("input",{attrs:{type:"range",id:"variance",min:"0",max:"45",step:"0.01",value:"15"},on:{change:function(t){return e.varianceChange(t)}}}),e._v(" "+e._s(e.variance_value)+" ")]),e._m(2),i("p",[e._v(" Input window size for filter: "),i("input",{attrs:{type:"text",id:"window_size"},domProps:{value:e.window_size},on:{change:function(t){return e.windowChange(t)}}})])]),i("div",{attrs:{id:"metrics"}},[i("p",[e._v(" Select IQ Metric: "),i("select",{attrs:{name:"metric"},on:{change:function(t){return e.metricChange(t)}}},[i("option",{attrs:{value:"PSNRHVSM"}},[e._v("PSNR-HVS-M")]),i("option",{attrs:{value:"PSNR"}},[e._v("PSNR")]),i("option",{attrs:{value:"IWSSIM"}},[e._v("IWSSIM")])])]),i("span",[e._v(" Calculated: "),i("br"),e._v(" "+e._s(e.metric)+" for noisy image: "+e._s(e.noisyMetricTF)),i("br"),e._v(" "+e._s(e.metric)+" for filtered image: "+e._s(e.filteredMetricTF)),i("br"),e._v(" "+e._s(e.metric)+" improvement: "+e._s(e.imptovementMetricTF)),i("br")]),i("span",[e._v(" Calculated: "),i("br"),e._v(" "+e._s(e.metric)+" for noisy image: "),i("br"),e._v(" "+e._s(e.metric)+" for filtered image: "),i("br"),e._v(" "+e._s(e.metric)+" improvement: ")])])])])},o=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"processingImage"}},[i("div",{attrs:{id:"loadedIm"}},[i("canvas",{attrs:{id:"loadedImage"}})]),i("div",{attrs:{id:"distortedIm"}},[i("canvas",{attrs:{id:"distortedImage"}})]),i("div",{attrs:{id:"filteredIm"}},[i("canvas",{attrs:{id:"filteredImage"}})])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("p",[e._v("Select noise type: "),i("select",{attrs:{name:"noise_type"}},[i("option",{attrs:{value:"AWGN"}},[e._v("AWGN")]),i("option",{attrs:{value:"ASCN",disabled:""}},[e._v("ASCN")])])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("p",[e._v(" Select filter type: "),i("select",{attrs:{name:"filter_type"}},[i("option",{attrs:{value:"DCT Based"}},[e._v("DCT Based")]),i("option",{attrs:{value:"BM3D",disabled:""}},[e._v("BM3D")])])])}],c=(i("ace4"),i("b680"),i("d3b7"),i("cfc3"),i("5cc6"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("3c5d"),i("2954"),i("649e"),i("219c"),i("170b"),i("b39a"),i("72f7"),i("96cf"),i("1da1")),f=i("0b53");function d(e,t,i){return h.apply(this,arguments)}function h(){return h=Object(c["a"])(regeneratorRuntime.mark((function e(t,i,r){var a,n,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,f["a"]("https://viktorovich21.github.io/"+t+"/model.json");case 2:return a=e.sent,n=a.predict(f["b"](i,[1,16])).dataSync(),s=[u(n[0],t),n[0],n[0]],n=a.predict(f["b"](r,[1,16])).dataSync(),s[1]=u(n[0],t),s[2]=s[1]-s[0],e.abrupt("return",s);case 9:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}function u(e,t){var i=0,r=0;switch(t){case"ADDSSIM":i=.9999,r=.9783;break;case"GMSD":i=.2702,r=.0024;break;case"GSM":i=.9998,r=.9437;break;case"HaarPSI":i=.987,r=.2237;break;case"IWSSIM":i=.9994,r=.9437;break;case"MSSSIM":i=.9995,r=.5354;break;case"PSNR":i=38.807,r=18.5933;break;case"PSNRHVSM":i=51.7829,r=20.6627;break;case"WSNR":i=50.0256,r=20.6656;break;default:i=1,r=-1}return i<e?i:r>e?r:(e- -1)*(i-r)/2+r}var l=d;function m(){this.next=function(e,t){if(e=void 0==e?0:e,t=void 0==t?1:t,this.ready)return this.ready=!1,this.second*t+e;var i,r,a;do{i=2*Math.random()-1,r=2*Math.random()-1,a=i*i+r*r}while(a>1||0==a);var n=Math.sqrt(-2*Math.log(a)/a);return this.second=n*i,this.ready=!0,n*r*t+e}}var g=m,p={mounted:function(){this.im_width=this.image.width,this.im_height=this.image.height;var e=document.getElementById("loadedImage");e.width=this.im_width,e.height=this.im_height;var t=e.getContext("2d");this.loadedCanvas=t,this.loadedCanvas.drawImage(this.image,0,0),e=document.getElementById("distortedImage"),e.width=this.im_width,e.height=this.im_height,t=e.getContext("2d"),this.distortedImage=t,this.distortedImage.drawImage(this.image,0,0),e=document.getElementById("filteredImage"),e.width=this.im_width,e.height=this.im_height,t=e.getContext("2d"),this.filteredImage=t,this.filteredImage.drawImage(this.image,0,0),this.loadWasmModule(),this.distordImageAWGN()},name:"ImProcessing",props:{image:Image},data:function(){return{distortedImage:this.image,filteredImage:this.image,noise_type:"AWGN",filter_type:"DCT Based",metric:"PSNRHVSM",variance_value:15,im_width:0,im_height:0,window_size:8,noisyMetricTF:0,filteredMetricTF:0,imptovementMetricTF:0,wasmMemory:void 0,Rbuffer_init:void 0,Gbuffer_init:void 0,Bbuffer_init:void 0,freq_buffer_init:void 0,coffOffset:void 0,calcDCTCoff:void 0,applyDCTFilter:void 0,buffer_destroy:void 0,destroyBuffersCofficient:void 0}},methods:{metricChange:function(e){this.metric=e.target.value,this.predictMetricsValue()},varianceChange:function(e){this.variance_value=e.target.value,this.distordImageAWGN(),this.aplyDCT()},windowChange:function(e){var t=e.target.value;"2"!=t&&"4"!=t&&"8"!=t&&"16"!=t&&"32"!=t||(this.window_size=t,console.log(t),this.aplyDCT())},getImagePixels:function(e){var t=e.getImageData(0,0,this.im_width,this.im_height).data;return t},predictMetricsValue:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t,i,r,a,n,s,o,c,f,d,h;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=this.freq_buffer_init(this.im_width,this.im_height),r){for(console.log(r),a=this.coffOffset(),console.log(a),n=new Float32Array(this.wasmMemory.buffer,a,16),s=new Uint8Array(this.wasmMemory.buffer,r,this.im_width*this.im_height),o=this.getImagePixels(this.distortedImage),c=0,f=0;f<o.length;f+=4,c++)s[c]=o[f];for(this.calcDCTCoff(),c=0;c<16;c++)t[c]=n[c];for(this.destroyBuffersCofficient(),r=this.freq_buffer_init(this.im_width,this.im_height),console.log(r),a=this.coffOffset(),console.log(a),n=new Float32Array(this.wasmMemory.buffer,a,16),s=new Uint8Array(this.wasmMemory.buffer,r,this.im_width*this.im_height),o=this.getImagePixels(this.filteredImage),c=0,d=0;d<o.length;d+=4,c++)s[c]=o[d];for(this.calcDCTCoff(),c=0;c<16;c++)i[c]=n[c];this.destroyBuffersCofficient()}return console.log(t),e.next=7,l(this.metric,t,i);case 7:h=e.sent,this.noisyMetricTF=h[0].toFixed(3),this.filteredMetricTF=h[1].toFixed(3),this.imptovementMetricTF=h[2].toFixed(3);case 11:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),distordImageAWGN:function(){var e=this.getImagePixels(this.loadedCanvas);console.log(e);for(var t=new g,i=this.distortedImage.getImageData(0,0,this.im_width,this.im_height),r=i.data,a=0;a<e.length;a++)a%4!=0&&(r[a]=t.next(0,this.variance_value)+e[a]);console.log(i),this.distortedImage.putImageData(i,0,0)},aplyDCT:function(){var e=this.Rbuffer_init(this.im_width,this.im_height),t=this.Gbuffer_init(this.im_width,this.im_height),i=this.Bbuffer_init(this.im_width,this.im_height);if(e&&t&&i){for(var r=new Uint8Array(this.wasmMemory.buffer,e,this.im_width*this.im_height),a=new Uint8Array(this.wasmMemory.buffer,t,this.im_width*this.im_height),n=new Uint8Array(this.wasmMemory.buffer,i,this.im_width*this.im_height),s=this.getImagePixels(this.distortedImage),o=0,c=0;c<s.length;c+=4,o++)r[o]=s[c],a[o]=s[c+1],n[o]=s[c+2];console.log(r),this.applyDCTFilter(this.window_size,this.variance_value);var f=this.filteredImage.getImageData(0,0,this.im_width,this.im_height),d=f.data;o=0;for(var h=0;h<s.length;h+=4,o++)d[h]=r[o],d[h+1]=a[o],d[h+2]=n[o],d[h+3]=255;console.log(f),this.filteredImage.putImageData(f,0,0),this.buffer_destroy(),this.predictMetricsValue()}},loadWasmModule:function(){var e=this;Object(c["a"])(regeneratorRuntime.mark((function t(){var i,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.wasmMemory=new WebAssembly.Memory({initial:256,maximum:512}),i={env:{memoryBase:0,tableBase:0,memory:e.wasmMemory,table:new WebAssembly.Table({initial:0,element:"anyfunc"})}},t.next=4,WebAssembly.instantiateStreaming(fetch("https://viktorovich21.github.io/WASMOperation.wasm"),i);case 4:r=t.sent,a=r.instance,e.Rbuffer_init=a.exports.Rbuffer_init,e.Gbuffer_init=a.exports.Gbuffer_init,e.Bbuffer_init=a.exports.Bbuffer_init,e.applyDCTFilter=a.exports.applyDCTFilter,e.buffer_destroy=a.exports.destroy_buffer,e.destroyBuffersCofficient=a.exports.destroyAll,e.freq_buffer_init=a.exports.buffer_init,e.coffOffset=a.exports.getCoffOffset,e.calcDCTCoff=a.exports.calcDCTCoefficients,console.log(a.exports.getModuleVersion()),e.aplyDCT();case 17:case"end":return t.stop()}}),t)})))()}}},v=p,_=(i("e159"),i("50d3")),b=Object(_["a"])(v,s,o,!1,null,"351c047c",null),w=b.exports,y={name:"app",data:function(){return{image:void 0,bufferArray:void 0,isFileLoad:!1}},components:{ImProcessing:w},methods:{addFile:function(e){var t=e.dataTransfer.files;t&&this.loadFileToImage(t[0])},addFileFromButton:function(e){var t=e.target.files;t&&this.loadFileToImage(t[0])},loadFileToImage:function(e){console.log(e);var t=new FileReader,i=this;t.onload=function(e){var t=new Image;t.onload=function(){console.log(t.width,t.height,t.decoding),i.image=t,i.isFileLoad=!0},t.src=e.target.result},t.readAsDataURL(e)}}},I=y,M=(i("cf25"),Object(_["a"])(I,a,n,!1,null,null,null)),C=M.exports;r["a"].config.productionTip=!1,new r["a"]({render:function(e){return e(C)}}).$mount("#app")},6:function(e,t){},"86bb":function(e,t,i){},c93a:function(e,t,i){e.exports=i.p+"img/upload.7cc8eb70.svg"},cf25:function(e,t,i){"use strict";var r=i("3803"),a=i.n(r);a.a},e159:function(e,t,i){"use strict";var r=i("86bb"),a=i.n(r);a.a}});
//# sourceMappingURL=app.96df3b49.js.map